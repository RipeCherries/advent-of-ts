# Connect 4, –Ω–æ –Ω–∞ TypeScript —Ç–∏–ø–∞—Ö

## üá∫üá∏ –û–ø–∏—Å–∞–Ω–∏–µ

Your goal for this challenge is to implement Connect 4 in TypeScript types.

Each cell in the game can contain `üî¥` or `üü°` or be empty (` `).
You're provided with a rough layout of how to organize the board in the EmptyBoard type.
The game state is represented by an object with a board property and a state property
(which keeps track of which player is next up to play).

In case you haven't played it before: Connect 4 is a game in which the players choose a color and then take
turns dropping colored tokens into a six-row, seven-column vertically suspended grid. The pieces fall straight down,
occupying the lowest available space within the column. The objective of the game is to be the first to form a
horizontal, vertical, or diagonal line of four of one's own tokens.

> **fun fact**: Connect 4 is also known as Connect Four, Four Up, Plot Four, Find Four, Captain's Mistress,
> Four in a Row, Drop Four, and Gravitrips in the Soviet Union

> **another fun fact**: Connect 4 was "solved" by James Allen and Victor Allis (independently from one another..
> like two weeks apart!) in 1988. They couldn't do a full brute-force proof at the time, but 7 years
> later John Tromp in the Netherlands did it with a database on a Sun Microsystems and
> Silicon Graphics International worksations (for a combined total of 40,000 computation hours!).

## üá∑üá∫ –û–ø–∏—Å–∞–Ω–∏–µ

–í–∞—à–∞ —Ü–µ–ª—å –≤ —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–≥—Ä—É Connect 4 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–∏–ø–æ–≤ TypeScript.

–ö–∞–∂–¥–∞—è –∫–ª–µ—Ç–∫–∞ –≤ –∏–≥—Ä–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å `üî¥` –∏–ª–∏ `üü°` –∏–ª–∏ –±—ã—Ç—å –ø—É—Å—Ç–æ–π (` `).
–í —Ç–∏–ø–µ `EmptyBoard` –≤–∞–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ö–µ–º–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è.
–°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–º —Å–æ —Å–≤–æ–π—Å—Ç–≤–æ–º `board` –∏ —Å–≤–æ–π—Å—Ç–≤–æ–º `state `
(–∫–æ—Ç–æ—Ä–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç, –∫—Ç–æ –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ –±—É–¥–µ—Ç –∏–≥—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º).

–ï—Å–ª–∏ –≤—ã –Ω–µ –∏–≥—Ä–∞–ª–∏ —Ä–∞–Ω—å—à–µ: Connect 4 ‚Äî —ç—Ç–æ –∏–≥—Ä–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫–∏ –≤—ã–±–∏—Ä–∞—é—Ç —Ü–≤–µ—Ç –∏ –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ –±—Ä–æ—Å–∞—é—Ç
—Ñ–∏—à–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ –≤ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é —Ä–µ—à–µ—Ç–∫—É —Ä–∞–∑–º–µ—Ä–æ–º —à–µ—Å—Ç—å —Ä—è–¥–æ–≤ –∏ —Å–µ–º—å —Å—Ç–æ–ª–±—Ü–æ–≤.
–§–∏—à–∫–∏ –ø–∞–¥–∞—é—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ –≤–Ω–∏–∑, –∑–∞–Ω–∏–º–∞—è —Å–∞–º–æ–µ –Ω–∏–∑–∫–æ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤ —Å—Ç–æ–ª–±—Ü–µ.
–¶–µ–ª—å –∏–≥—Ä—ã ‚Äî –ø–µ—Ä–≤—ã–º —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é, –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é –∏–ª–∏ –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é –∏–∑ —á–µ—Ç—ã—Ä–µ—Ö —Å–≤–æ–∏—Ö —Ñ–∏—à–µ–∫.

> **–ó–∞–±–∞–≤–Ω—ã–π —Ñ–∞–∫—Ç**: Connect 4 —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–∞ –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ Connect Four, Four Up, Plot Four, Find Four,
> Captain's Mistress, Four in a Row, Drop Four, –∏ Gravitrips –≤ –°–æ–≤–µ—Ç—Å–∫–æ–º –°–æ—é–∑–µ.

> **–ï—â–µ –æ–¥–∏–Ω –∑–∞–±–∞–≤–Ω—ã–π —Ñ–∞–∫—Ç**: Connect 4 –±—ã–ª–∞ "—Ä–µ—à–µ–Ω–∞" –î–∂–µ–π–º—Å–æ–º –ê–ª–ª–µ–Ω–æ–º –∏ –í–∏–∫—Ç–æ—Ä–æ–º –ê–ª–ª–∏—Å–æ–º
> (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, —Å —Ä–∞–∑–Ω–∏—Ü–µ–π –≤—Å–µ–≥–æ –≤ –¥–≤–µ –Ω–µ–¥–µ–ª–∏!) –≤ 1988 –≥–æ–¥—É.
> –ü–æ–ª–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ø–µ—Ä–µ–±–æ—Ä–æ–º —Ç–æ–≥–¥–∞ —Å–¥–µ–ª–∞—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å, –Ω–æ —á–µ—Ä–µ–∑ —Å–µ–º—å –ª–µ—Ç –î–∂–æ–Ω –¢—Ä–æ–º–ø
> –∏–∑ –ù–∏–¥–µ—Ä–ª–∞–Ω–¥–æ–≤ —Å–º–æ–≥ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ä–∞–±–æ—á–∏—Ö —Å—Ç–∞–Ω—Ü–∏—è—Ö Sun Microsystems –∏
> Silicon Graphics International (–≤ –æ–±—â–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞—Ç—Ä–∞—Ç–∏–≤ 40 000 —á–∞—Å–æ–≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π!).

## üíª –†–µ—à–µ–Ω–∏–µ

```typescript
import { Expect, Equal } from "type-testing";

// –†–µ—à–µ–Ω–∏–µ
type Connect4Empty = "  ";
type Connect4Chips = "üî¥" | "üü°";
type Connect4Cell = Connect4Chips | Connect4Empty;
type Connect4Board = Connect4Cell[][];

type EmptyBoard = [
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "]
];

type NewGame = {
    board: EmptyBoard;
    state: "üü°";
};

type Connect4Game = { board: Connect4Board; state: Connect4Chips };

type Connect4<
    T extends Connect4Game,
    C extends number,
    R extends number = FindIndex2D<T["board"], C>,
    B extends Connect4Board = Replace2D<T["board"], R, C, T["state"]>
> =
    CheckRows<B, T['state']> extends true ? { board: B, state: `${T['state']} Won` } :
        CheckCols<B, T['state'], C> extends true ? { board: B, state: `${T['state']} Won` } :
            CheckDiagLeftToRight<B, T['state']> extends true ? { board: B, state: `${T['state']} Won` } :
                CheckDiagRightToLeft<B, T['state']> extends true ? { board: B, state: `${T['state']} Won` } :
                    CheckDraw<B> extends true ? { board: B, state: "Draw" } :
                        { board: B, state: { "üî¥": "üü°"; "üü°": "üî¥" }[T['state']] };

type CheckDraw<T extends any[][]> =
    T extends [infer First extends any[], ...infer Rest extends any[][]]
        ? HasEmpty1D<First> extends true
            ? false
            : CheckDraw<Rest>
        : true;

type HasEmpty1D<T extends any[]> =
    T extends [infer First, ...infer Rest]
        ? First extends Connect4Empty
            ? true
            : HasEmpty1D<Rest>
        : false

type FindIndex2D<T extends Connect4Board, P extends number, Acc extends 0[] = []> =
    T extends [...infer Rest extends any[][], infer Last extends any[]]
        ? Last[P] extends "  "
            ? Acc["length"]
            : FindIndex2D<Rest, P, [0, ...Acc]>
        : never;

type Replace2D<T extends any[][], IR extends number, IC extends number, V extends any, Acc extends any[][] = []> =
    T extends [...infer Rest extends any[][], infer Last extends any[]]
        ? Acc["length"] extends IR
            ? [...Rest, Replace1D<Last, IC, V>, ...Acc]
            : Replace2D<Rest, IR, IC, V, [Last, ...Acc]>
        : T;

type Replace1D<T extends any[], I extends number, V extends any, Acc extends any[] = []> =
    T extends [infer First, ...infer Rest]
        ? Acc["length"] extends I
            ? [...Acc, V, ...Rest]
            : Replace1D<Rest, I, V, [...Acc, First]>
        : T;

type CheckRows<T extends any[][], V extends Connect4Chips> =
    T extends [infer First extends any[], ...infer Rest extends any[][]]
        ? CheckWin1D<First, V> extends true
            ? true
            : CheckRows<Rest, V>
        : false;

type CheckCols<
    T extends any[][],
    V extends Connect4Chips,
    P extends number
> = T extends [
        infer R1 extends any[],
        infer R2 extends any[],
        infer R3 extends any[],
        infer R4 extends any[],
        ...infer Rest extends any[][]
    ]
    ? [R1[P], R2[P], R3[P], R4[P]] extends [V, V, V, V]
        ? true
        : CheckCols<[R2, R3, R4, ...Rest], V, P>
    : false;

type CheckDiagLeftToRight<
    T extends any[][],
    V extends Connect4Chips
> = T extends [
        infer R1 extends any[],
        infer R2 extends any[],
        infer R3 extends any[],
        infer R4 extends any[],
        ...infer Rest extends any[][]
    ]
    ? R2 extends [any, ...infer R2Rest]
        ? R3 extends [any, any, ...infer R3Rest]
            ? R4 extends [any, any, any, ...infer R4Rest]
                ? CheckQuadRow<R1, R2Rest, R3Rest, R4Rest, V> extends true
                    ? true
                    : CheckDiagLeftToRight<[R2, R3, R4, ...Rest], V>
                : false
            : false
        : false
    : false;

type CheckDiagRightToLeft<
    T extends any[][],
    V extends Connect4Chips
> = T extends [
        infer R1 extends any[],
        infer R2 extends any[],
        infer R3 extends any[],
        infer R4 extends any[],
        ...infer Rest extends any[][]
    ]
    ? R3 extends [any, ...infer R3Rest]
        ? R2 extends [any, any, ...infer R2Rest]
            ? R1 extends [any, any, any, ...infer R1Rest]
                ? CheckQuadRow<R1Rest, R2Rest, R3Rest, R4, V> extends true
                    ? true
                    : CheckDiagRightToLeft<[R2, R3, R4, ...Rest], V>
                : false
            : false
        : false
    : false;

type CheckQuadRow<
    R1 extends any[],
    R2 extends any[],
    R3 extends any[],
    R4 extends any[],
    V extends any,
    Acc extends 0[] = [],
    i extends number = Acc["length"]
> = R1["length"] extends i
    ? false
    : [R1[i], R2[i], R3[i], R4[i]] extends [V, V, V, V]
        ? true
        : CheckQuadRow<R1, R2, R3, R4, V, [...Acc, 0]>;

type CheckWin1D<T extends any[], V extends any> =
    T extends [infer I1, infer I2, infer I3, infer I4, ...infer Rest]
        ? [I1, I2, I3, I4] extends [V, V, V, V]
            ? true
            : CheckWin1D<[I2, I3, I4, ...Rest], V>
        : false;

// –¢–µ—Å—Ç—ã
type test_move1_actual = Connect4<NewGame, 0>;
type test_move1_expected = {
    board: [
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "  ", "  ", "  ", "  ", "  ", "  "],
    ];
    state: "üî¥";
};
type test_move1 = Expect<Equal<test_move1_actual, test_move1_expected>>;

type test_move2_actual = Connect4<test_move1_actual, 0>;
type test_move2_expected = {
    board: [
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üî¥", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "  ", "  ", "  ", "  ", "  ", "  "],
    ];
    state: "üü°";
};
type test_move2 = Expect<Equal<test_move2_actual, test_move2_expected>>;

type test_move3_actual = Connect4<test_move2_actual, 0>;
type test_move3_expected = {
    board: [
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üî¥", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "  ", "  ", "  ", "  ", "  ", "  "],
    ];
    state: "üî¥";
};
type test_move3 = Expect<Equal<test_move3_actual, test_move3_expected>>;

type test_move4_actual = Connect4<test_move3_actual, 1>;
type test_move4_expected = {
    board: [
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üî¥", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "üî¥", "  ", "  ", "  ", "  ", "  "],
    ];
    state: "üü°";
};
type test_move4 = Expect<Equal<test_move4_actual, test_move4_expected>>;

type test_move5_actual = Connect4<test_move4_actual, 2>;
type test_move5_expected = {
    board: [
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üî¥", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "üî¥", "üü°", "  ", "  ", "  ", "  "],
    ];
    state: "üî¥";
};
type test_move5 = Expect<Equal<test_move5_actual, test_move5_expected>>;

type test_move6_actual = Connect4<test_move5_actual, 1>;
type test_move6_expected = {
    board: [
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "  ", "  ", "  ", "  ", "  ", "  "],
        ["üî¥", "üî¥", "  ", "  ", "  ", "  ", "  "],
        ["üü°", "üî¥", "üü°", "  ", "  ", "  ", "  "],
    ];
    state: "üü°";
};
type test_move6 = Expect<Equal<test_move6_actual, test_move6_expected>>;

type test_red_win_actual = Connect4<
    {
        board: [
            ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
            ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
            ['üü°', '  ', '  ', '  ', '  ', '  ', '  '],
            ['üü°', '  ', '  ', '  ', '  ', '  ', '  '],
            ['üî¥', 'üî¥', 'üî¥', '  ', '  ', '  ', '  '],
            ['üü°', 'üî¥', 'üü°', 'üü°', '  ', '  ', '  ']
        ];
        state: 'üî¥';
    }
>;

type test_red_win_expected = {
    board: [
        ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
        ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
        ['üü°', '  ', '  ', '  ', '  ', '  ', '  '],
        ['üü°', '  ', '  ', '  ', '  ', '  ', '  '],
        ['üî¥', 'üî¥', 'üî¥', 'üî¥', '  ', '  ', '  '],
        ['üü°', 'üî¥', 'üü°', 'üü°', '  ', '  ', '  ']
    ];
    state: 'üî¥ Won';
};
type test_red_win = Expect<Equal<test_red_win_actual, test_red_win_expected>>;

type test_yellow_win_actual = Connect4<
    {
        board: [
            ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
            ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
            ['üî¥', '  ', '  ', '  ', '  ', '  ', '  '],
            ['üü°', '  ', '  ', '  ', '  ', '  ', '  '],
            ['üî¥', '  ', 'üî¥', 'üî¥', '  ', '  ', '  '],
            ['üü°', '  ', 'üü°', 'üü°', '  ', '  ', '  ']
        ];
        state: 'üü°';
    }
>;

type test_yellow_win_expected = {
    board: [
        ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
        ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
        ['üî¥', '  ', '  ', '  ', '  ', '  ', '  '],
        ['üü°', '  ', '  ', '  ', '  ', '  ', '  '],
        ['üî¥', '  ', 'üî¥', 'üî¥', '  ', '  ', '  '],
        ['üü°', 'üü°', 'üü°', 'üü°', '  ', '  ', '  ']
    ];
    state: 'üü° Won';
};
type test_yellow_win = Expect<Equal<test_yellow_win_actual, test_yellow_win_expected>>;

type test_diagonal_yellow_win_actual = Connect4<
    {
        board: [
            ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
            ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
            ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
            ['  ', '  ', 'üü°', 'üî¥', '  ', '  ', '  '],
            ['üî¥', 'üü°', 'üî¥', 'üî¥', '  ', '  ', '  '],
            ['üü°', 'üî¥', 'üü°', 'üü°', '  ', '  ', '  ']
        ];
        state: 'üü°';
    }
>;

type test_diagonal_yellow_win_expected = {
    board: [
        ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
        ['  ', '  ', '  ', '  ', '  ', '  ', '  '],
        ['  ', '  ', '  ', 'üü°', '  ', '  ', '  '],
        ['  ', '  ', 'üü°', 'üî¥', '  ', '  ', '  '],
        ['üî¥', 'üü°', 'üî¥', 'üî¥', '  ', '  ', '  '],
        ['üü°', 'üî¥', 'üü°', 'üü°', '  ', '  ', '  ']
    ];
    state: 'üü° Won';
};

type test_diagonal_yellow_win = Expect<Equal<test_diagonal_yellow_win_actual, test_diagonal_yellow_win_expected>>;

type test_draw_actual = Connect4<
    {
        board: [
            ['üü°', 'üî¥', 'üî¥', 'üü°', 'üü°', 'üî¥', '  '],
            ['üî¥', 'üü°', 'üü°', 'üî¥', 'üî¥', 'üü°', 'üî¥'],
            ['üü°', 'üî¥', 'üî¥', 'üü°', 'üü°', 'üî¥', 'üü°'],
            ['üî¥', 'üü°', 'üü°', 'üî¥', 'üî¥', 'üü°', 'üî¥'],
            ['üü°', 'üî¥', 'üî¥', 'üü°', 'üü°', 'üî¥', 'üü°'],
            ['üî¥', 'üü°', 'üü°', 'üî¥', 'üî¥', 'üü°', 'üî¥']
        ];
        state: 'üü°';
    }
>;

type test_draw_expected = {
    board: [
        ['üü°', 'üî¥', 'üî¥', 'üü°', 'üü°', 'üî¥', 'üü°'],
        ['üî¥', 'üü°', 'üü°', 'üî¥', 'üî¥', 'üü°', 'üî¥'],
        ['üü°', 'üî¥', 'üî¥', 'üü°', 'üü°', 'üî¥', 'üü°'],
        ['üî¥', 'üü°', 'üü°', 'üî¥', 'üî¥', 'üü°', 'üî¥'],
        ['üü°', 'üî¥', 'üî¥', 'üü°', 'üü°', 'üî¥', 'üü°'],
        ['üî¥', 'üü°', 'üü°', 'üî¥', 'üî¥', 'üü°', 'üî¥']
    ];
    state: 'Draw';
};
type test_draw = Expect<Equal<test_draw_actual, test_draw_expected>>;
```